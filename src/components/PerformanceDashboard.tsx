\nimport React, { useMemo } from \'react\';\nimport {\n  Paper,\n  Typography,\n  Grid,\n  Tooltip,\n  Box,\n  CircularProgress,\n} from \'@mui/material\';\nimport { Timestamp } from \'firebase/firestore\';\nimport {\n  ComposedChart,\n  Line,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip as RechartsTooltip,\n  ResponsiveContainer,\n  Legend,\n  Cell,\n} from \'recharts\';\nimport useAuth from \'../hooks/useAuth\';\nimport useAnalytics from \'../hooks/useAnalytics\';\n\n// --- TYPE DEFINITIONS ---\n\ninterface Round {\n  id?: string;\n  profit: number;\n  timestamp: Timestamp;\n  outcome: \'win\' | \'loss\';\n}\n\ninterface PerformanceDashboardProps {\n  rounds: Round[];\n}\n\n// --- STYLED COMPONENT FOR AI CARDS ---\n\nconst AiInsightCard = ({\n  title,\n  value,\n  unit,\n  tooltip,\n  glowColor = \'#00FFC6\',\n}: {\n  title: string;\n  value: string;\n  unit?: string;\n  tooltip: string;\n  glowColor?: string;\n}) => (\n  <Tooltip title={tooltip} placement=\"top\">\n    <Paper\n      sx={{{\n        p: 2,\n        textAlign: \'center\',\n        color: \'white\',\n        borderRadius: \'16px\',\n        height: \'100%\',\n        background: \'rgba(27, 27, 39, 0.7)\', // Glassmorphism background\n        backdropFilter: \'blur(10px)\',\n        border: `1px solid ${glowColor}`,\n        animation: \'pulse 2.5s cubic-bezier(0.4, 0, 0.6, 1) infinite\',\n        transition: \'transform 0.3s ease, box-shadow 0.3s ease\',\n        \'&:hover\': {\n          transform: \'translateY(-5px) scale(1.03)\',\n          boxShadow: `0 0 25px 3px ${glowColor}`,\n        },\n      }}}\n    >\n      <Typography variant=\"h4\" className=\"font-orbitron font-bold\">\n        {value}\n        {unit && (\n          <Typography component=\"span\" variant=\"h6\" sx={{ ml: 0.5 }}>\n            {unit}\n          </Typography>\n        )}\n      </Typography>\n      <Typography variant=\"body2\" sx={{ color: \'#c7c7c7\' }}>\n        {title}\n      </Typography>\n    </Paper>\n  </Tooltip>\n);\n\n// --- MAIN COMPONENT ---\n\nconst PerformanceDashboard: React.FC<PerformanceDashboardProps> = ({ rounds }) => {\n  const { user } = useAuth();\n  const { analytics, loading } = useAnalytics(user);\n\n  const bankrollData = useMemo(() => {\n    return rounds\n      .slice()\n      .reverse()\n      .reduce((acc, round, index) => {\n        const previousBankroll = acc.length > 0 ? acc[acc.length - 1].bankroll : 0;\n        acc.push({\n          name: `R${index + 1}`,\n          profit: round.profit,\n          bankroll: previousBankroll + round.profit,\n        });\n        return acc;\n      }, [] as { name: string; profit: number; bankroll: number }[]);\n  }, [rounds]);\n\n  return (\n    <Paper\n      elevation={12}\n      sx={{{\n        p: { xs: 2, md: 3 },\n        mt: 4,\n        color: \'white\',\n        border: \'1px solid #4B00FF\',\n        borderRadius: \'20px\',\n        background: \'rgba(10, 10, 20, 0.5)\',\n        backdropFilter: \'blur(5px)\',\n      }}}\n    >\n      <Typography variant=\"h5\" gutterBottom className=\"font-orbitron font-bold\">\n        AI Performance Dashboard\n      </Typography>\n\n      {loading ? (\n        <Box sx={{ display: \'flex\', justifyContent: \'center\', my: 4 }}>\n          <CircularProgress sx={{ color: \'#00FFC6\' }} />\n        </Box>\n      ) : !analytics ? (\n        <Typography sx={{ textAlign: \'center\', my: 4, color: \'#c7c7c7\' }}>\n          Log your first round to see AI insights.\n        </Typography>\n      ) : (\n        <Box>\n          <Grid container spacing={2} sx={{ mt: 2, mb: 4 }}>\n            <Grid item xs={6} sm={4} md={2}>\n              <AiInsightCard\n                title=\"Win Rate\"\n                value={analytics.winRate.toFixed(1)}\n                unit=\"%\"\n                tooltip=\"Percentage of rounds won\"\n                glowColor=\"#00FFC6\"\n              />\n            </Grid>\n            <Grid item xs={6} sm={4} md={2}>\n              <AiInsightCard\n                title=\"Avg. Multiplier\"\n                value={analytics.avgMultiplier.toFixed(2)}\n                unit=\"x\"\n                tooltip=\"Your average winning multiplier\"\n                glowColor=\"#00C4FF\"\n              />\n            </Grid>\n            <Grid item xs={6} sm={4} md={2}>\n              <AiInsightCard\n                title=\"Risk/Reward\"\n                value={analytics.riskRewardRatio.toFixed(2)}\n                unit=\"\"\n                tooltip=\"Ratio of average win to average loss\"\n                glowColor=\"#FFD700\"\n              />\n            </Grid>\n            <Grid item xs={6} sm={4} md={2}>\n              <AiInsightCard\n                title=\"Best Range\"\n                value={analytics.bestRange}\n                unit=\"x\"\n                tooltip=\"The multiplier range where you are most profitable\"\n                glowColor=\"#FF6B00\"\n              />\n            </Grid>\n            <Grid item xs={6} sm={4} md={2}>\n                <AiInsightCard\n                    title=\"Profit Consistency\"\n                    value={analytics.profitConsistencyScore.toFixed(0)}\n                    unit=\"%\"\n                    tooltip=\"Measures the stability of your earnings. Higher is better.\"\n                    glowColor=\"#DA70D6\"\n                />\n            </Grid>\n            <Grid item xs={6} sm={4} md={2}>\n                <AiInsightCard\n                    title=\"Max Loss Streak\"\n                    value={analytics.lossStreaks.toString()}\n                    unit=\"rounds\"\n                    tooltip=\"The longest consecutive number of losing rounds.\"\n                    glowColor=\"#FF4136\"\n                />\n            </Grid>\n          </Grid>\n          <Tooltip title={analytics.performanceSummary} placement=\"top\">\n            <Paper\n              sx={{{\n                p: 2,\n                mb: 4,\n                textAlign: \'center\',\n                color: \'white\',\n                borderRadius: \'16px\',\n                height: \'100%\',\n                background: \'linear-gradient(135deg, rgba(75, 0, 255, 0.3), rgba(0, 255, 198, 0.2))\',\n                border: `1px solid #4B00FF`,\n                boxShadow: `0 0 20px 0px #4B00FF`,\n              }}}\n            >\n              <Typography variant=\"body1\" className=\"font-orbitron font-bold mb-1\">\n                &#x1F4A1; AI Suggestion\n              </Typography>\n              <Typography variant=\"body2\" sx={{ color: \'#e0e0e0\' }}>\n                {analytics.aiSuggestion}\n              </Typography>\n            </Paper>\n          </Tooltip>\n        </Box>\n      )}\n\n      <Typography variant=\"h6\" className=\"font-orbitron font-bold mt-4 mb-2\">\n        Bankroll Progression\n      </Typography>\n      <ResponsiveContainer width=\"100%\" height={300}>\n        <ComposedChart data={bankrollData} margin={{ top: 5, right: 20, left: -10, bottom: 5 }}>\n          <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(75, 0, 255, 0.3)\" />\n          <XAxis dataKey=\"name\" stroke=\"#c7c7c7\" />\n          <YAxis yAxisId=\"left\" stroke=\"#00FFC6\" />\n          <YAxis yAxisId=\"right\" orientation=\"right\" stroke=\"#FFD700\" />\n          <RechartsTooltip\n            contentStyle={{{\n              backgroundColor: \'rgba(27, 27, 39, 0.9)\',\n              backdropFilter: \'blur(5px)\',\n              border: \'1px solid #00FFC6\',\n              color: \'white\',\n            }}}\n            formatter={(value: number, name: string) =>\n              name === \'Profit\' ? `$${value.toFixed(2)}` : `$${value.toFixed(2)}`\n            }\n          />\n          <Legend wrapperStyle={{ color: \'white\' }} />\n          <Bar yAxisId=\"right\" dataKey=\"profit\" name=\"Profit\">\n            {bankrollData.map((entry, index) => (\n              <Cell key={`cell-${index}`} fill={entry.profit >= 0 ? \'#00C4FF\' : \'#FF6B00\'} />\n            ))}\n          </Bar>\n          <Line\n            yAxisId=\"left\"\n            type=\"monotone\"\n            dataKey=\"bankroll\"\n            name=\"Bankroll\"\n            stroke=\"#00FFC6\"\n            strokeWidth={2}\n            dot={false}\n            activeDot={{ r: 8, style: { fill: \'#fff\', stroke: \'#00FFC6\' } }}\n          />\n        </ComposedChart>\n      </ResponsiveContainer>\n    </Paper>\n  );\n};\n\nexport default PerformanceDashboard;\n